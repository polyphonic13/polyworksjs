/*! polyworksjs v0.1.0 2014-05-16 */
function trace(){"undefined"==typeof console||"undefined"==typeof console.log?console={log:function(){}}:Polyworks.Utils.each(arguments,function(a){console.log(a)},this)}var Polyworks={};Polyworks.Stage=function(){function a(){h.winW=document.documentElement.clientWidth,h.winH=document.documentElement.clientHeight,h.height=document.documentElement.clientHeight>800?800:document.documentElement.clientHeight,h.width=document.documentElement.clientHeight/f[1]*f[0],h.width>document.documentElement.clientWidth&&(h.width=document.documentElement.clientWidth,h.height=h.width/f[0]*f[1]),h.unit=h.height/f[1];var a=document.documentElement.clientWidth/2-h.width/2,c=document.documentElement.clientHeight/2-h.height/2;trace("\nwinW = "+h.winW+", winH = "+h.winH+"\nmodule.width = "+h.width+", module.height = "+h.height+"\nunit = "+h.unit+"\nleft = "+a+", top = "+c);var d=h.winW-80,e=h.winH-80,g=document.getElementById("loading"),i=document.getElementById("gameContainer");b(g,d,e,0,0),b(i,h.winW,h.winH,0,0)}function b(a,b,c,d,e){a&&(a.style.width=b+"px",a.style.height=c+"px",a.style.left=d+"px",a.style.top=e+"px",a.style.display="block")}function c(){var a=document.getElementById("gameContainer"),b=document.documentElement.clientWidth/2-h.width/2,c=document.documentElement.clientHeight/2-h.height/2;a.style.left=b+"px",a.style.top=c+"px"}var d,e,f=[16,9],g=!1,h={winW:0,winH:0,stageW:0,stageH:0,unit:0,init:function(b,g,h,i){"undefined"!=typeof b&&(f=b),d=h,e=i||window,a(),g&&(window.addEventListener("resize",function(a){c(a)}),window.addEventListener("orientationchagne",function(a){c(a)}))},destroy:function(){g&&(window.removeEventListener("resize",function(a){c(a)}),window.removeEventListener("orientationchagne",function(a){c(a)}))}};return h}(),Polyworks.Utils=function(){var a={};return a.each=function(a,b,c){if(Array.isArray(a))for(var d=a.length,e=0;d>e;e++)b.call(c,a[e],e,a);else for(var f in a)b.call(c,a[f],f,a)},a.clone=function(a){if(null==a||"object"!=typeof a)return a;if(a instanceof Date){var b=new Date;return b.setTime(a.getTime()),b}if(a instanceof Array){for(var b=[],c=0,d=a.length;d>c;c++)b[c]=Polyworks.Utils.clone(a[c]);return b}if(a instanceof Object){var b={};for(var e in a)a.hasOwnProperty(e)&&(b[e]=Polyworks.Utils.clone(a[e]));return b}throw new Error("Unable to copy obj! Its type isn't supported.")},a.extend=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a},a.extract=function(a,b){var c=a[b];return a!==window&&delete a[b],c},a.has=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},a.objLength=function(a){var b=0;for(var c in a)Utils.has(a,c)&&b++;return b},a.mixin=function(a,b){for(var c in b)b[c]&&(a[c]=b[c])},a.bind=function(a,b){return function(){return b.apply(a,arguments)}},a.inherits=function(a,b){function c(){this.constructor=a}this.mixin(a,b),c.prototype=a._super=b.prototype,a.prototype=new c},a.isInView=function(a){return a.x>0&&a.x<stageConfig.width&&a.y>0&&a.y<stageConfig.height?!0:!1},a.parseMarkup=function(a,b,c){var d=a;if(a.indexOf("~{")>-1){var e=/~\{[A-Z]*\}~/gi,f=a.match(e);if(f)for(var g in f){var h=String(f[g]),i=h.length,j=h.substring(2,i-2),k=b[j];c&&(k=encodeURIComponent(k)),k=void 0===k||null===k?h:k.toString(),d=d.replace(h,k)}else d=null}return d},a.loadScript=function(a,b){var c=document.createElement("script");c.setAttribute("type","text/javascript"),c.readyState?c.onreadystatechange=function(){("loaded"==c.readyState||"complete"==c.readyState)&&Polyworks.EventCenter.trigger(b)}:c.onload=function(){Polyworks.EventCenter.trigger(b)},c.setAttribute("src",a),document.getElementsByTagName("head")[0].appendChild(c)},a}(),Polyworks.EventCenter=function(){var a={},b={};return a.bind=function(a,c,d){var e=d||this;b[a]||(b[a]=[]),b[a].push({callback:c,context:e})},a.trigger=function(a){var c=b[a.type];c&&Polyworks.Utils.each(c,function(b){b&&b.callback&&b.callback.call(b.context,a)},this)},a.unbind=function(a,c){var d=b[a];d&&Polyworks.Utils.each(d,function(a,b){a&&a.callback===c&&d.splice(b,1)},this)},a.destroy=function(){Polyworks.Utils.each(b,function(a,c){a=[],delete b[c]},this),b=[]},a}(),Polyworks.Events={CHANGE_SCREEN:"changeScreen"},Polyworks.PhaserAnimation=function(){function a(a,b,c){if(this.sprite=a,this.animations=b,this.currentAnimation=c||"",Polyworks.each(b,function(b,c){a.animations.add(c,b.keyFrames,b.frameRate)},this),c){var d=b[c];this.play(c,d.frameRate,d.looped)}}var b={};return a.prototype.play=function(a,b){if(a!==this.currentAnimation){var c=b||!1,d=this.animations[a];this.animations.play(a,d.frameRate,d.looped,c),this.currentAnimation=a}},a.prototype.stop=function(){this.sprite.animations.stop(),this.currentAnimation=""},b.Animator=a,b}(),Polyworks.PhaserPhysics=function(){var a={};return a}(),Polyworks.PhaserSprite=function(){function a(a){trace("PhaserSprite/constructor, config = ",a)}return a}(),Polyworks.PhaserText=void 0,Polyworks.DisplayFactory=function(){var a={};return a.createViews=function(a){trace("DisplayFactory/createViews, views = ",a);var b=[];return Polyworks.Utils.each(a,function(a){trace("	view.type = "+a.type),b.push(new Polyworks[a.type](a))},this),b},a}(),Polyworks.ScreenManager=function(){function a(a){trace("ScreenController/constructor, config = ",a),this.config=a,this.id=a.id,this.views=Polyworks.DisplayFactory.createViews(a.views)}var b={};return a.prototype.activate=function(){trace("ScreenController["+this.id+"]/activate"),Polyworks.each(this.views,function(a){a.show()},this),this.active=!0},a.prototype.update=function(){trace("ScreenController["+this.id+"]/update"),Polyworks.each(this.views,function(a){a.update()},this)},a.prototype.deactive=function(){trace("ScreenController["+this.id+"]/deactivate"),Polyworks.each(this.views,function(a){a.hide()},this),this.active=!1},a.prototype.destroy=function(){trace("ScreenController["+this.id+"]/destroy"),Polyworks.each(this.views,function(a,b){a.destroy(),delete this.views[b]},this)},b.ScreenController=a,b.init=function(a){trace("ScreenManager/init, config = ",a),this.config=a,this.screens={},this.currentId="",Polyworks.Utils.each(a,function(a){trace("	adding screen["+a.id+"]"),this.screens[a.id]=new this.ScreenController(a)},this),trace("	screens = ",this.screens)},b.activate=function(a){trace("ScreenManager/activate, id = "+a+", currentId = "+this.currentId),this.currentId!==a&&this.screens.hasOwnProperty(a)&&(""!==this.currentId&&this.screens[this.currentId].deactivate(),this.currentId=a,trace("	screens["+a+"] = ",this.screens[a]),this.screens[a].activate())},b.update=function(){this.screens[this.currentId].update()},b.deactivate=function(a){this.screens.hasOwnProperty(a)&&(this.screens[a].deactivate(),this.currentId===a&&(this.currentId=""))},b.deactivateAll=function(){Polyworks.Utils.each(this.screens,function(a,b){this.scr(b).deactivate()},this),this.currentId=""},b.destroy=function(){},b}(),Polyworks.DOMManager=function(){function a(a,b){_this=this,this.numToLoad=a.length,this.numLoaded=0,this.model=a,this.callback=b,this.images={},Polyworks.Utils.each(a,function(a){this.images[a.id]=new Image,this.images[a.id].onload=function(a){a.imageLoaded()}(this),this.images[a.id].src=a.src},this)}var b=document.getElementsByTagName("body")[0],c=document.getElementsByTagName("head")[0],d={addElements:function(a,c){var d=c||b;Polyworks.Utils.each(a,function(a){trace("DOMManager/addElements, type = "+a.type+", element = ",a);var b=document.createElement(a.type);a.attrs&&(b=this.addAttributes(a.attrs,b)),a.css&&(b=this.addStyle(a.css,b)),a.className&&(b.className=a.className),a.html&&(b.innerHTML=a.html),d.appendChild(b)},this)},addElementToBody:function(a){b.appendChild(a)},addElementToHead:function(a){c.appendChild(a)},addAttributes:function(a,b){return Polyworks.Utils.each(a,function(a,c){b.setAttribute(c,a)},this),b},addStyle:function(a,b){return Polyworks.Utils.each(a,function(a,c){b.style[c]=a},this),b},loadScript:function(a,b,c){var d=c||window,e=document.createElement("script");e.setAttribute("type","text/javascript"),e.readyState?e.onreadystatechange=function(){("loaded"==e.readyState||"complete"==e.readyState)&&b.call(d,a,e)}:e.onload=function(){b.call(d,a,e)},e.setAttribute("src",a),_head.appendChild(e)}};return a.prototype={imageLoaded:function(){this.numLoaded++,this.numLoaded===this.numToLoad&&this.callback()},getImage:function(a){return this.images[a]}},d.ImageLoader=a,d}(),Polyworks.SocialPanel=function(){function a(){b(),c()}function b(){j.parentEl=document.getElementById(j.parentId)||document.getElementsByTagName("body")[0],j.grandParentEl=j.parentEl.parentNode}function c(){j.buttons={};var a,b,c=j.buttonStyle,e=j.buttonClass||"socialButton",f=j.networks.length;Polyworks.Utils.each(j.networks,function(g,h){b=d(c,h,f),a={pops:j.parentEl,id:g,el:"img",attrs:{src:j.imagePath+g+".png",onclick:'Polyworks.SocialPanel.buttonClick("'+g+'");'},className:e,style:b},j.buttons[g]=Polyworks.Utils.addElement(a)},this)}function d(a,b,c){var d=Polyworks.Stage.winW,e=Polyworks.Stage.winH,f=a.position.horizontal,g=a.position.vertical,h=(a.spacer,a.offset||0),i={width:a.size.width+"px",height:a.size.height+"px"};if("center"===f){for(var j,k=0;c>k;k++)k>0&&(j+=a.spacer),j+=a.size.width;i.left=d/2-j/2+b*a.size.width+"px"}else 0>f?i.right=-f+"px":i.left=f+"px";if("center"===g){for(var l=0,k=0;c>k;k++)k>0&&(l+=a.spacer),l+=a.size.height;var m=b*a.size.height+b*a.spacer+h;i.top=e/2-l/2+m+"px"}else 0>g?i.bottom=-g+"px":i.top=g+"px";return i}function e(){var a,b=j.buttons;for(var c in b)a=b[c],a.parentNode.removeChild(a);j.parentEl&&j.parentEl.parentNode.removeChild(j.parentEl)}function f(){Polyworks.Utils.each(j.listeners,function(a){Polyworks.EventCenter.bind(a.type,h,this)},this)}function g(){Polyworks.Utils.each(j.listeners,function(a){Polyworks.EventCenter.unbind(a.type,h,this)},this)}function h(a){var b;Polyworks.Utils.each(j.listeners,function(c){c.type===a.type&&(b=c)},this);var c=b.match;c?c.value===a.value?i(c.actions):b.nonmatch&&i(b.nonmatch.actions):i(b.actions)}function i(a){Polyworks.Utils.each(a,function(a){Polyworks.SocialPanel[a.method](a.data)},this)}var j={},k={init:function(b){j=Polyworks.Utils.extend(j,b),a(),f()},show:function(a){var b=a.value;j.parentEl.style.display="block",Polyworks.Utils.each(b,function(a){j.buttons.hasOwnProperty(a)&&(j.buttons[a].style.visibility="visible")},this)},showAll:function(){j.parentEl.style.display="block";for(var a in j.buttons)j.buttons[a].style.visibility="visible"},hideAll:function(){j.parentEl.style.display="none";for(var a in j.buttons)j.buttons[a].style.visibility="hidden"},buttonClick:function(a){var b=j.socialActions[a];if(b){var c=b[j.currentActionType];if(c){var d;d=c.params?c.url+Polyworks.Utils.parseMarkup(c.params,j,!0):c.url,d.indexOf("mailto")>-1&&(Polyworks.DeviceUtils.isIphone()||Polyworks.DeviceUtils.isAndroid())?window.location.href=d:window.open(d,"_blank")}}},changeData:function(a){j[a.type]=a.value},destroy:function(){g(),e()}};return k}();