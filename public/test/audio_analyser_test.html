<!DOCTYPE html>
<html>
	<head>
	<script type="text/javascript" src="../src/js/utils/logger.js"></script>
	<script type="text/javascript" src="../src/js/utils/utils.js"></script>
	<script type="text/javascript" src="../src/js/utils/timer.js"></script>
	<script type="text/javascript" src="../src/js/animation/animator.js"></script>
	<script type="text/javascript" src="../src/js/audio/audio_manager.js"></script>
	<script type="text/javascript" src="../src/js/colors/color.js"></script>
	<script type="text/javascript" src="js/audio_analyser_test.js"></script>
	</head>
	<style>
		body {
			background: black;
		}
		#block_container {
			width:100%;
			height: 100%;
			position: absolute;
		}
		.lil_div {
/*			background: #123456;*/
			position:absolute;
			z-index: 100;
		}
	</style>
	<body>

		<div id="block_container"></div>
		<canvas id="analyser_output" width="800" height="512" />
		<script type="text/javascript">
		function audioCreated() {
			trace('audioCreated');
			// PWG.AudioManager.play(audioConfig.id);
		}
		
		var audioConfig = {
			id: 'marchToTheSea',
			sources: [{
				src: 'assets/audio/march_to_the_sea.mp3'
			},
			{
				src: 'assets/audio/march_to_the_sea.ogg'
			}],
			cb: audioCreated,
			ctx: this
		};
		
		var divBoxes = [];
		// var parentEl = document.getElementsByTagName('body')[0];
		var parentEl = document.getElementById('block_container');
		var winW = document.documentElement.clientWidth;
		var winH = document.documentElement.clientHeight;
		var larger = (winW > winH) ? winW : winH; 
		var diameter = larger;
		var radius = diameter/2;
		var x0 = larger/2;
		var y0 = winH/2;
		var items = 256;
		var min = 20;
		var boxesPercent = 100/items;
        var outputOnce = false;

		
		function rotateHolder() {
			var time = 20000;
			var endRot = Math.random() * 360;
			var neg = PWG.Utils.coinToss();
			var beginRot = (neg) ? (endRot - 180) : (endRot + 180);

			var animations = [{ key: 'rotate', begin: beginRot, end: endRot, unit: '' }];

			PWG.Animator.create(
				parentEl, 
				animations, 
				time, 
				true, 
				function(animationId, el, params) {
					rotationComplete();
				}, 
				this,
				{}
			);
			
		}
		
		function rotationComplete() {
			trace('rotationComplete');
			rotateHolder();
		}
		
		PWG.Utils.onDomReady(function() {
			// PWG.AudioManager.createEl(audioConfig);
			AudioAnalyserTest.init();

			
			for (var i = 0; i < items; i++) {
				var b = document.createElement('div');
				b.className = 'lil_div';
				divBoxes.push(b);

				var p = i * boxesPercent;

				var bg = PWG.Color.percentToHex(p/100);

				b.style.background = bg;
				b.style.width = larger / (items) + 'px';
				b.style.height = larger / (items) + 'px';
				
				parentEl.appendChild(b);
			}
			
			rotateHolder();

		});
		</script>
		
	</body>
</html>